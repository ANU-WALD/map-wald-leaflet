!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@angular/core"),require("@angular/forms"),require("@ng-bootstrap/ng-bootstrap"),require("@angular/common/http"),require("@angular/common"),require("map-wald"),require("leaflet"),require("leaflet-draw"),require("leaflet.vectorgrid"),require("store")):"function"==typeof define&&define.amd?define("map-wald-leaflet",["@angular/core","@angular/forms","@ng-bootstrap/ng-bootstrap","@angular/common/http","@angular/common","map-wald","leaflet","leaflet-draw","leaflet.vectorgrid","store"],t):(e=e||self)["map-wald-leaflet"]=t(e.ng.core,e.ng.forms,e.ngBootstrap,e.ng.common.http,e.ng.common,e.mapWald,e.leaflet,e.leafletDraw,e.leaflet_vectorgrid,e.store)}(this,(function(e,t,n,o,a,r,i,l,s,p){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a,r=r&&r.hasOwnProperty("default")?r.default:r,i=i&&i.hasOwnProperty("default")?i.default:i,l=l&&l.hasOwnProperty("default")?l.default:l,s=s&&s.hasOwnProperty("default")?s.default:s,p=p&&p.hasOwnProperty("default")?p.default:p;var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function u(e,t){return e(t={exports:{}},t.exports),t.exports}var m=u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LeafletService=void 0;var o=e,a=function(){function e(){var e=this;this.map=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.mapCreated=function(e){this.resolve(e)},e.prototype.withMap=function(e){this.map.then(e)},e.ɵfac=function(t){return new(t||e)},e.ɵprov=o.ɵɵdefineInjectable({token:e,factory:e.ɵfac}),e}();n.LeafletService=a})),f=(d(m),m.LeafletService,u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LeafletMapComponent=void 0;var o=e,a=m,r=["*"],l="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",s=function(){function e(e,t){this.element=e,this.svc=t,this.zoomControl=!0,this.minZoom=5,this.maxZoom=32,this.styles={},this.initialised=!1,console.log("LeafletMapComponent")}return e.prototype.ngOnChanges=function(e){if(this.initialised){Object.keys(e).length;this.updateMap(e),e.bounds&&this.setBounds()}},e.prototype.ngOnInit=function(){this.updateMap(),this.setBounds()},e.prototype.updateMap=function(e){var t=this;setTimeout((function(){t.map?e&&e.baseMap&&(t.baseLayer?t.baseLayer.setUrl(t.baseMap.urlTemplate||l):t.baseMap&&(t.createBaseLayer(),t.baseLayer.addTo(t.map).bringToBack())):t.createMap()}))},e.prototype.createBaseLayer=function(){if(this.baseLayer=null,this.baseMap){var e={};this.baseMap.maxNativeZoom&&(e.maxNativeZoom=this.baseMap.maxNativeZoom),this.baseLayer=i.tileLayer(this.baseMap.urlTemplate||l,e)}},e.prototype.createMap=function(){var e=this;setTimeout((function(){e.map&&(e.map.remove(),e.map=null);var t=e.element.nativeElement.querySelector(".leafletHost"),n=i.CRS.EPSG3857;e.createBaseLayer();var o=[];e.baseLayer&&o.push(e.baseLayer),e.map=i.map(t,{crs:n,zoom:5,minZoom:e.minZoom,maxZoom:e.maxZoom,zoomControl:e.zoomControl,center:i.latLng(-20,135),scrollWheelZoom:!0,layers:o,continuousWorld:!1,noWrap:!0}),e.svc.mapCreated(e.map),e.map.on("click",(function(e){e.originalEvent.defaultPrevented})),e.setBounds(),e.initialised=!0}))},e.prototype.setBounds=function(){this.map&&this.bounds&&this.map.fitBounds([[this.bounds.south,this.bounds.west],[this.bounds.north,this.bounds.east]])},e.ɵfac=function(t){return new(t||e)(o.ɵɵdirectiveInject(o.ElementRef),o.ɵɵdirectiveInject(a.LeafletService))},e.ɵcmp=o.ɵɵdefineComponent({type:e,selectors:[["leaflet-map"]],inputs:{bounds:"bounds",baseMap:"baseMap",zoomControl:"zoomControl",minZoom:"minZoom",maxZoom:"maxZoom"},features:[o.ɵɵNgOnChangesFeature],ngContentSelectors:r,decls:2,vars:2,consts:[[1,"leafletHost"]],template:function(e,t){1&e&&(o.ɵɵprojectionDef(),o.ɵɵelementStart(0,"div",0),o.ɵɵprojection(1),o.ɵɵelementEnd()),2&e&&o.ɵɵstyleMap(t.styles)},styles:[".leafletHost[_ngcontent-%COMP%]{\n    width:100%;\n    min-height:400px;\n  }"]}),e}();n.LeafletMapComponent=s}))),h=(d(f),f.LeafletMapComponent,u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DrawComponent=void 0;var o=e,a=m,r=function(){function t(t){this.map=t,this.featureClosed=new e.EventEmitter}return t.prototype.ngOnDestroy=function(){var e=this;this.map.withMap((function(t){return e.removeControl(t)}))},t.prototype.ngOnInit=function(){var e=this;this.map.withMap((function(t){return e.addControl(t)}))},t.prototype.removeControl=function(e){e.removeLayer(this.drawnItems),this.polygon.removeHooks(),e.off(i.Draw.Event.DRAWSTART),e.off(i.Draw.Event.CREATED)},t.prototype.addControl=function(e){var t=this;this.drawnItems=new i.FeatureGroup,e.addLayer(this.drawnItems),this.initiateDrawing(e),e.on(i.Draw.Event.DRAWSTART,(function(e){t.drawnItems.clearLayers()})),e.on(i.Draw.Event.DRAWVERTEX,(function(e){t.drawnItems.clearLayers()})),e.on(i.Draw.Event.CREATED,(function(n){console.log(n);var o=n.layer;t.drawnItems.clearLayers(),t.drawnItems.addLayer(o),t.featureClosed.emit(o.toGeoJSON()),t.polygon.removeHooks(),t.initiateDrawing(e)}))},t.prototype.initiateDrawing=function(e){this.polygon=new i.Draw.Polygon(e,{repeatMode:!1}),this.polygon.addHooks()},t.ɵfac=function(e){return new(e||t)(o.ɵɵdirectiveInject(a.LeafletService))},t.ɵcmp=o.ɵɵdefineComponent({type:t,selectors:[["draw"]],outputs:{featureClosed:"featureClosed"},decls:0,vars:0,template:function(e,t){},encapsulation:2}),t}();n.DrawComponent=r}))),y=(d(h),h.DrawComponent,u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.GeojsonLayerComponent=void 0;var a=e,r=o,l=m,s={fillOpacity:0,weight:1},p=function(){function t(t,n){this.http=t,this.map=n,this.sublayers=[],this.featureSelected=new e.EventEmitter,this.destroyed=!1}return t.prototype.ngOnInit=function(){},t.prototype.ngOnDestroy=function(){var e=this;this.destroyed=!0,this.map.map.then((function(t){e.remove(t)}))},t.prototype.remove=function(e){this.vectorLayer&&(this.vectorLayer.removeFrom(e),this.vectorLayer=null)},t.prototype.ngOnChanges=function(e){var t=this;e.url&&this.http.get(this.url).subscribe((function(n){e.url.currentValue===t.url&&t.map.map.then((function(e){t.remove(e),t.destroyed||(t.vectorLayer=i.geoJSON(n,{style:s}),t.vectorLayer.on("click",(function(e){t.selectedFeature&&t.vectorLayer.resetStyle(t.selectedFeature),t.selectedFeature=e.layer,t.selectedFeature.setStyle({weight:5}),t.featureSelected.emit(t.selectedFeature.feature)})),t.vectorLayer.addTo(e))}))}))},t.ɵfac=function(e){return new(e||t)(a.ɵɵdirectiveInject(r.HttpClient),a.ɵɵdirectiveInject(l.LeafletService))},t.ɵcmp=a.ɵɵdefineComponent({type:t,selectors:[["geojson-layer"]],inputs:{url:"url",styles:"styles",sublayers:"sublayers"},outputs:{featureSelected:"featureSelected"},features:[a.ɵɵNgOnChangesFeature],decls:0,vars:0,template:function(e,t){},styles:[""]}),t}();n.GeojsonLayerComponent=p}))),v=(d(y),y.GeojsonLayerComponent,u((function(t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.makeColour=o.LegendComponent=void 0;var r=e;function i(e,t){if(1&e&&r.ɵɵelement(0,"span",5),2&e){var n=r.ɵɵnextContext();r.ɵɵproperty("innerHtml",n.helpText,r.ɵɵsanitizeHtml)}}function l(e,t){if(1&e&&r.ɵɵelement(0,"span",6),2&e){var n=r.ɵɵnextContext();r.ɵɵproperty("innerHTML","("+n.mapUnits+")",r.ɵɵsanitizeHtml)}}function s(e,t){if(1&e&&(r.ɵɵelementStart(0,"span",7),r.ɵɵelement(1,"i",8),r.ɵɵelementEnd()),2&e){var n=r.ɵɵnextContext(),o=r.ɵɵreference(2);r.ɵɵproperty("ngbTooltip",o)("placement",n.tooltipPlacement)}}var p=function(e){return{background:e}};function c(e,t){if(1&e&&(r.ɵɵelementStart(0,"div",11),r.ɵɵelementStart(1,"div",12),r.ɵɵelement(2,"i",13),r.ɵɵelementEnd(),r.ɵɵelementStart(3,"div",14),r.ɵɵelement(4,"span",6),r.ɵɵelementEnd(),r.ɵɵelementEnd()),2&e){var n=t.$implicit,o=t.index,a=r.ɵɵnextContext(2);r.ɵɵadvance(2),r.ɵɵproperty("ngStyle",r.ɵɵpureFunction1(2,p,n)),r.ɵɵadvance(2),r.ɵɵproperty("innerHTML",a.labels[o],r.ɵɵsanitizeHtml)}}function d(e,t){if(1&e&&(r.ɵɵelementStart(0,"div"),r.ɵɵelementStart(1,"div",9),r.ɵɵtemplate(2,c,5,4,"div",10),r.ɵɵelementEnd(),r.ɵɵelementEnd()),2&e){var n=r.ɵɵnextContext();r.ɵɵadvance(2),r.ɵɵproperty("ngForOf",n.colours)}}function u(e,t){if(1&e&&(r.ɵɵelementStart(0,"div"),r.ɵɵelement(1,"img",15),r.ɵɵelementEnd()),2&e){var n=r.ɵɵnextContext();r.ɵɵadvance(1),r.ɵɵproperty("src",n.imageURL,r.ɵɵsanitizeUrl)}}function m(e,t){if(1&e&&(r.ɵɵelementStart(0,"p"),r.ɵɵtext(1,"Source: "),r.ɵɵelementStart(2,"a",16),r.ɵɵtext(3),r.ɵɵelementEnd(),r.ɵɵelementEnd()),2&e){var n=r.ɵɵnextContext();r.ɵɵadvance(2),r.ɵɵproperty("href",n.attributionLink,r.ɵɵsanitizeUrl),r.ɵɵadvance(1),r.ɵɵtextInterpolate(n.attribution||"details")}}function f(e,t){if(1&e&&(r.ɵɵelementStart(0,"p"),r.ɵɵtext(1),r.ɵɵelementEnd()),2&e){var n=r.ɵɵnextContext();r.ɵɵadvance(1),r.ɵɵtextInterpolate1("Source: ",n.attribution,"")}}var h=function(){function e(){this.colours=["red","white","blue"],this.labels=[],this.title="the title",this.mapUnits="",this.tooltipPlacement="right",this.generatedLabels=[]}return e.prototype.ngOnInit=function(){},e.ɵfac=function(t){return new(t||e)},e.ɵcmp=r.ɵɵdefineComponent({type:e,selectors:[["legend"]],inputs:{colours:"colours",labels:"labels",imageURL:"imageURL",title:"title",mapUnits:"mapUnits",helpText:"helpText",tooltipPlacement:"tooltipPlacement",attribution:"attribution",attributionLink:"attributionLink"},decls:11,vars:7,consts:[[1,"map-legend","panel","panel-group"],["tooltipContent",""],[3,"innerHTML",4,"ngIf"],["container","body",3,"ngbTooltip","placement",4,"ngIf"],[4,"ngIf"],[3,"innerHtml"],[3,"innerHTML"],["container","body",3,"ngbTooltip","placement"],[1,"fa","fa-info-circle"],[2,"display","table","line-height","15px"],["style","display:table-row;padding:0;",4,"ngFor","ngForOf"],[2,"display","table-row","padding","0"],[1,"legend-colour"],[1,"legend-entry",3,"ngStyle"],[1,"legend-label"],[3,"src"],[3,"href"]],template:function(e,t){1&e&&(r.ɵɵelementStart(0,"div",0),r.ɵɵtemplate(1,i,1,1,"ng-template",null,1,r.ɵɵtemplateRefExtractor),r.ɵɵelementStart(3,"strong"),r.ɵɵtext(4),r.ɵɵtemplate(5,l,1,1,"span",2),r.ɵɵtemplate(6,s,2,2,"span",3),r.ɵɵelementEnd(),r.ɵɵtemplate(7,d,3,1,"div",4),r.ɵɵtemplate(8,u,2,1,"div",4),r.ɵɵtemplate(9,m,4,2,"p",4),r.ɵɵtemplate(10,f,2,1,"p",4),r.ɵɵelementEnd()),2&e&&(r.ɵɵadvance(4),r.ɵɵtextInterpolate1("",t.title," "),r.ɵɵadvance(1),r.ɵɵproperty("ngIf",t.mapUnits),r.ɵɵadvance(1),r.ɵɵproperty("ngIf",t.helpText),r.ɵɵadvance(1),r.ɵɵproperty("ngIf",!t.imageURL),r.ɵɵadvance(1),r.ɵɵproperty("ngIf",t.imageURL),r.ɵɵadvance(1),r.ɵɵproperty("ngIf",t.attributionLink),r.ɵɵadvance(1),r.ɵɵproperty("ngIf",t.attribution&&!t.attributionLink))},directives:[a.NgIf,n.NgbTooltip,a.NgForOf,a.NgStyle],styles:[".map-legend[_ngcontent-%COMP%]{\n  display:block;\n  background: white;\n}\n\n.legend-colour[_ngcontent-%COMP%]{\n  display:table-cell;\n  padding:0px;\n}\n\n.legend-label[_ngcontent-%COMP%]{\n  display:table-cell;\n  padding:0px 4px 2px 2px;\n  font-size:10px;\n  vertical-align:middle;\n}\n\n.legend-entry[_ngcontent-%COMP%] {\n  float: left;\n  width: 15px !important;\n  height: 15px !important;\n}"]}),e}();o.LegendComponent=h,o.makeColour=function(e,t,n,o){return"rgb("+e+","+t+","+n+","+(o=void 0===o?1:o)+")"}}))),g=(d(v),v.makeColour,v.LegendComponent,u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MapControlComponent=void 0;var o=e,a=m,r=["mapControl"],l=["*"],s=["INPUT","SELECT","OPTION"],p=function(){function e(e,t){this._el=e,this._map=t,this.position="TOP_RIGHT",this.touchDevice=!1}return e.prototype.ngOnInit=function(){},e.prototype.ngAfterViewInit=function(){var e=this,t=this._el.nativeElement.querySelector(".map-control-content");if("DIV"!==t.nodeName){var n=document.createElement("div");n.appendChild(t),t=n}var o=i.Control.extend({onAdd:function(e){return t},onRemove:function(e){}});this._map.map.then((function(t){var n;(n={position:e.position.replace(/_/g,"").toLowerCase()},new o(n)).addTo(t)}))},e.prototype.ontouchstart=function(e){this.touchDevice=!0,s.indexOf(e.target.tagName)>=0&&e.stopPropagation(),this.enableMapEvents()},e.prototype.disableMapEvents=function(){this.touchDevice||this._map.map.then((function(e){e.dragging.disable(),e.scrollWheelZoom.disable()}))},e.prototype.enableMapEvents=function(){this._map.map.then((function(e){var t=!0;!0&&e.dragging.enable(),t&&e.scrollWheelZoom.enable()}))},e.ɵfac=function(t){return new(t||e)(o.ɵɵdirectiveInject(o.ElementRef),o.ɵɵdirectiveInject(a.LeafletService))},e.ɵcmp=o.ɵɵdefineComponent({type:e,selectors:[["map-control"]],viewQuery:function(e,t){if(1&e&&o.ɵɵviewQuery(r,!0),2&e){var n;o.ɵɵqueryRefresh(n=o.ɵɵloadQuery())&&(t.mapControl=n.first)}},inputs:{position:"position"},ngContentSelectors:l,decls:3,vars:0,consts:[[1,"map-control-content",3,"touchstart","mouseenter","mouseleave"],["mapControl",""]],template:function(e,t){1&e&&(o.ɵɵprojectionDef(),o.ɵɵelementStart(0,"div",0,1),o.ɵɵlistener("touchstart",(function(e){return t.ontouchstart(e)}))("mouseenter",(function(){return t.disableMapEvents()}))("mouseleave",(function(){return t.enableMapEvents()})),o.ɵɵprojection(2),o.ɵɵelementEnd())},styles:[".map-control-content[_ngcontent-%COMP%]{\n  background: transparent;\n}"]}),e}();n.MapControlComponent=p}))),C=(d(g),g.MapControlComponent,u((function(o,r){Object.defineProperty(r,"__esModule",{value:!0}),r.OneTimeSplashComponent=r.SplashCloseMode=void 0;var i=e,l=n,s=["splashTemplate"];function c(e,t){if(1&e){var n=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"div",6),i.ɵɵelementStart(1,"h4",7),i.ɵɵtext(2),i.ɵɵelementEnd(),i.ɵɵelementStart(3,"button",8),i.ɵɵlistener("click",(function(){return i.ɵɵrestoreView(n),(0,i.ɵɵnextContext().dismiss)("Cross click")})),i.ɵɵelementStart(4,"span",9),i.ɵɵtext(5,"×"),i.ɵɵelementEnd(),i.ɵɵelementEnd(),i.ɵɵelementEnd()}if(2&e){var o=i.ɵɵnextContext(2);i.ɵɵadvance(2),i.ɵɵtextInterpolate1(" ",o.label,"")}}function d(e,t){if(1&e){var n=i.ɵɵgetCurrentView();i.ɵɵelementStart(0,"label"),i.ɵɵelementStart(1,"input",10),i.ɵɵlistener("ngModelChange",(function(e){return i.ɵɵrestoreView(n),i.ɵɵnextContext(2).doNotShow=e}))("ngModelChange",(function(){return i.ɵɵrestoreView(n),i.ɵɵnextContext(2).doNotShowClicked()})),i.ɵɵelementEnd(),i.ɵɵtext(2),i.ɵɵelementEnd()}if(2&e){var o=i.ɵɵnextContext(2);i.ɵɵadvance(1),i.ɵɵproperty("ngModel",o.doNotShow),i.ɵɵadvance(1),i.ɵɵtextInterpolate1("   ",o.hideMessage," ")}}function u(e,t){if(1&e&&(i.ɵɵtemplate(0,c,6,1,"div",1),i.ɵɵelementStart(1,"div",2),i.ɵɵprojection(2),i.ɵɵelementEnd(),i.ɵɵelementStart(3,"div",3),i.ɵɵtemplate(4,d,3,2,"label",4),i.ɵɵelementStart(5,"button",5),i.ɵɵlistener("click",(function(){return(0,t.close)("Close click")})),i.ɵɵtext(6,"Close"),i.ɵɵelementEnd(),i.ɵɵelementEnd()),2&e){var n=i.ɵɵnextContext();i.ɵɵproperty("ngIf",n.label),i.ɵɵadvance(4),i.ɵɵproperty("ngIf",n.application)}}var m,f=["*"];!function(e){e[e.NotOpened=0]="NotOpened",e[e.Accepted=1]="Accepted",e[e.Cancelled=2]="Cancelled"}(m=r.SplashCloseMode||(r.SplashCloseMode={}));var h=function(){function n(t){this.modalService=t,this.label="About",this.hideMessage="Understood, I don’t need to see this again",this.showOnLaunch=!0,this.closed=new e.EventEmitter}return n.prototype.storageKey=function(){return this.application?this.application+"-splash-skip":null},n.prototype.ngAfterViewInit=function(){var e=this;setTimeout((function(){var t=e.storageKey();t&&(e.doNotShow=p.get(t,!1)),e.showOnLaunch&&e.defaultShow()}))},n.prototype.defaultShow=function(){this.doNotShow?this.closed.emit(m.NotOpened):this.show()},n.prototype.show=function(){this.current=this.modalService.open(this.splashTemplate,{size:"lg",windowClass:this.klass})},n.prototype.close=function(){this.current?(this.current.close(),this.current=null,this.closed.emit(m.Accepted)):this.closed.emit(m.NotOpened)},n.prototype.doNotShowClicked=function(){var e=this.storageKey();e&&p.set(e,this.doNotShow)},n.ɵfac=function(e){return new(e||n)(i.ɵɵdirectiveInject(l.NgbModal))},n.ɵcmp=i.ɵɵdefineComponent({type:n,selectors:[["one-time-splash"]],viewQuery:function(e,t){if(1&e&&i.ɵɵviewQuery(s,!0),2&e){var n;i.ɵɵqueryRefresh(n=i.ɵɵloadQuery())&&(t.splashTemplate=n.first)}},inputs:{application:"application",label:"label",hideMessage:"hideMessage",klass:"klass",showOnLaunch:"showOnLaunch"},outputs:{closed:"closed"},ngContentSelectors:f,decls:2,vars:0,consts:[["splashTemplate",""],["class","modal-header",4,"ngIf"],[1,"modal-body"],[1,"modal-footer"],[4,"ngIf"],["autofocus","","type","button",1,"btn","btn-secondary",3,"click"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],["type","checkbox",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(i.ɵɵprojectionDef(),i.ɵɵtemplate(0,u,7,2,"ng-template",null,0,i.ɵɵtemplateRefExtractor))},directives:[a.NgIf,t.CheckboxControlValueAccessor,t.NgControlStatus,t.NgModel],styles:[""]}),n}();r.OneTimeSplashComponent=h}))),b=(d(C),C.OneTimeSplashComponent,C.SplashCloseMode,u((function(t,n){var o=c&&c.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,a,r=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(e){a={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i},a=c&&c.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e};Object.defineProperty(n,"__esModule",{value:!0}),n.VectorTileLayerComponent=void 0;var r=e,i=m,l=function(){function t(t){this.map=t,this.sublayers=[],this.featureSelected=new e.EventEmitter,this.destroyed=!1}return t.prototype.ngOnInit=function(){},t.prototype.ngOnDestroy=function(){var e=this;this.destroyed=!0,this.map.map.then((function(t){e.remove(t)}))},t.prototype.getFeatureId=function(e){var t=this.sublayers.find((function(t){return e.properties[t.keyField]}));return e.properties[t.keyField]},t.prototype.remove=function(e){this.vectorLayer&&(this.vectorLayer.removeFrom(e),this.vectorLayer=null)},t.prototype.ngOnChanges=function(e){var t=this;this.map.map.then((function(e){t.remove(e),t.destroyed||(t.vectorLayer=L.vectorGrid.protobuf(t.url,{minZoom:11,interactive:!0,vectorTileLayerStyles:t.styles,maxNativeZoom:13,getFeatureId:function(e){return t.getFeatureId(e)}}),t.vectorLayer.on("click",(function(e){t.selectedFeature&&t.vectorLayer.resetFeatureStyle(t.selectedFeature),t.selectedFeature=t.getFeatureId(e.layer),t.vectorLayer.setFeatureStyle(t.selectedFeature,{weight:5});var n=t.vectorGridFeatureToGeoJSON(e.layer);t.featureSelected.emit(n)})),t.vectorLayer.addTo(e))}))},t.prototype.vectorGridFeatureToGeoJSON=function(e){var t=(e._parts[0]&&e._parts[0][0]?e._parts:[e._parts]).map((function(e){return e.map((function(e){return[e.x,e.y]}))})),n=Math.min.apply(Math,a(t[0].map((function(e){return e[0]})))),o=Math.max.apply(Math,a(t[0].map((function(e){return e[0]})))),r=Math.min.apply(Math,a(t[0].map((function(e){return e[1]})))),i=Math.max.apply(Math,a(t[0].map((function(e){return e[1]}))));function l(e,t){var n=e[1]-e[0],o=t[1]-t[0];return function(a){return t[0]+(a-e[0])/n*o}}var s=l([n,o],[e.properties.minx,e.properties.maxx]),p=l([r,i],[e.properties.maxy,e.properties.miny]);return{type:"Feature",geometry:{type:"Polygon",coordinates:t.map((function(e){return e.map((function(e){return[s(e[0]),p(e[1])]}))}))},properties:e.properties}},t.ɵfac=function(e){return new(e||t)(r.ɵɵdirectiveInject(i.LeafletService))},t.ɵcmp=r.ɵɵdefineComponent({type:t,selectors:[["vector-tile-layer"]],inputs:{url:"url",styles:"styles",sublayers:"sublayers"},outputs:{featureSelected:"featureSelected"},features:[r.ɵɵNgOnChangesFeature],decls:0,vars:0,template:function(e,t){},encapsulation:2}),t}();n.VectorTileLayerComponent=l}))),S=(d(b),b.VectorTileLayerComponent,u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WmsLayerComponent=void 0;var o=e,a=m,r={format:"image/png",transparent:!0},l=function(){function e(e){this.map=e,this.params={}}return e.prototype.ngOnInit=function(){},e.prototype.ngOnChanges=function(e){var t=this;this.map.map.then((function(e){if(t.layer&&(t.layer.removeFrom(e),t.layer=null),t.url&&t.params){var n=Object.assign({},r,t.params);t.layer=i.tileLayer.wms(t.url,n),t.layer.addTo(e)}}))},e.ɵfac=function(t){return new(t||e)(o.ɵɵdirectiveInject(a.LeafletService))},e.ɵcmp=o.ɵɵdefineComponent({type:e,selectors:[["wms-layer"]],inputs:{url:"url",params:"params"},features:[o.ɵɵNgOnChangesFeature],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e}();n.WmsLayerComponent=l}))),w=(d(S),S.WmsLayerComponent,u((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DateElementComponent=void 0;var o=e,a=function(){function t(){this.step=1,this.changed=new e.EventEmitter,this.disabled=!1}return t.prototype.ngAfterViewInit=function(){},t.prototype.move=function(e){this.src[this.property]+=e,this.changed.emit(this.src)},t.ɵfac=function(e){return new(e||t)},t.ɵcmp=o.ɵɵdefineComponent({type:t,selectors:[["date-element"]],inputs:{label:"label",property:"property",src:"src",step:"step",disabled:"disabled"},outputs:{changed:"changed"},decls:12,vars:4,consts:[[1,"row","no-gutters"],[1,"col-4"],[1,"col-2"],[1,"btn","btn-secondary","btn-sm",3,"disabled","click"],[1,"fa","fa-angle-left"],[1,"btn","btn-link","btn-sm"],[1,"fa","fa-angle-right"]],template:function(e,t){1&e&&(o.ɵɵelementStart(0,"div",0),o.ɵɵelementStart(1,"div",1),o.ɵɵtext(2),o.ɵɵelementEnd(),o.ɵɵelementStart(3,"div",2),o.ɵɵelementStart(4,"button",3),o.ɵɵlistener("click",(function(){return t.move(-t.step)})),o.ɵɵelement(5,"i",4),o.ɵɵelementEnd(),o.ɵɵelementEnd(),o.ɵɵelementStart(6,"div",1),o.ɵɵelementStart(7,"button",5),o.ɵɵtext(8),o.ɵɵelementEnd(),o.ɵɵelementEnd(),o.ɵɵelementStart(9,"div",2),o.ɵɵelementStart(10,"button",3),o.ɵɵlistener("click",(function(){return t.move(t.step)})),o.ɵɵelement(11,"i",6),o.ɵɵelementEnd(),o.ɵɵelementEnd(),o.ɵɵelementEnd()),2&e&&(o.ɵɵadvance(2),o.ɵɵtextInterpolate(t.label),o.ɵɵadvance(2),o.ɵɵproperty("disabled",t.disabled),o.ɵɵadvance(4),o.ɵɵtextInterpolate(t.src[t.property]),o.ɵɵadvance(2),o.ɵɵproperty("disabled",t.disabled))},encapsulation:2}),t}();n.DateElementComponent=a}))),x=(d(w),w.DateElementComponent,u((function(o,i){Object.defineProperty(i,"__esModule",{value:!0}),i.DateSelectionComponent=void 0;var l=e,s=r;function p(e,t){if(1&e){var n=l.ɵɵgetCurrentView();l.ɵɵelementStart(0,"div",9),l.ɵɵlistener("click",(function(){l.ɵɵrestoreView(n);var e=l.ɵɵnextContext(2);return e.move(-e.stepDays)})),l.ɵɵelement(1,"i",11),l.ɵɵelementEnd()}}function c(e,t){if(1&e){var n=l.ɵɵgetCurrentView();l.ɵɵelementStart(0,"div",9),l.ɵɵlistener("click",(function(){l.ɵɵrestoreView(n);var e=l.ɵɵnextContext(2);return e.move(e.stepDays)})),l.ɵɵelement(1,"i",12),l.ɵɵelementEnd()}}function d(e,t){if(1&e){var n=l.ɵɵgetCurrentView();l.ɵɵelementStart(0,"div",3),l.ɵɵelementStart(1,"div",4),l.ɵɵelementStart(2,"div",5),l.ɵɵtemplate(3,p,2,0,"div",6),l.ɵɵelementStart(4,"input",7,8),l.ɵɵlistener("ngModelChange",(function(e){return l.ɵɵrestoreView(n),l.ɵɵnextContext().dateStruct=e}))("ngModelChange",(function(){return l.ɵɵrestoreView(n),l.ɵɵnextContext().dateStructChanged()})),l.ɵɵelementEnd(),l.ɵɵelementStart(6,"div",9),l.ɵɵlistener("click",(function(){l.ɵɵrestoreView(n);var e=l.ɵɵreference(5);return l.ɵɵnextContext().disabled||e.toggle()})),l.ɵɵelement(7,"i",10),l.ɵɵelementEnd(),l.ɵɵtemplate(8,c,2,0,"div",6),l.ɵɵelementEnd(),l.ɵɵelementEnd(),l.ɵɵelementEnd()}if(2&e){var o=l.ɵɵnextContext();l.ɵɵadvance(3),l.ɵɵproperty("ngIf",o.step),l.ɵɵadvance(1),l.ɵɵproperty("ngModel",o.dateStruct)("maxDate",o.maxDateStruct)("minDate",o.minDateStruct)("disabled",o.disabled),l.ɵɵadvance(4),l.ɵɵproperty("ngIf",o.step)}}function u(e,t){if(1&e){var n=l.ɵɵgetCurrentView();l.ɵɵelementStart(0,"date-element",15),l.ɵɵlistener("changed",(function(){return l.ɵɵrestoreView(n),l.ɵɵnextContext(2).dateStructChanged()})),l.ɵɵelementEnd()}if(2&e){var o=l.ɵɵnextContext(2);l.ɵɵproperty("src",o.dateStruct)("property","day")("label","Day")("step",o.stepDays)("disabled",o.disabled)}}function m(e,t){if(1&e){var n=l.ɵɵgetCurrentView();l.ɵɵelementStart(0,"date-element",16),l.ɵɵlistener("changed",(function(){return l.ɵɵrestoreView(n),l.ɵɵnextContext(2).dateStructChanged()})),l.ɵɵelementEnd()}if(2&e){var o=l.ɵɵnextContext(2);l.ɵɵproperty("src",o.dateStruct)("property","month")("label","Month")("disabled",o.disabled)}}function f(e,t){if(1&e){var n=l.ɵɵgetCurrentView();l.ɵɵelementStart(0,"date-element",16),l.ɵɵlistener("changed",(function(){return l.ɵɵrestoreView(n),l.ɵɵnextContext(2).dateStructChanged()})),l.ɵɵelementEnd()}if(2&e){var o=l.ɵɵnextContext(2);l.ɵɵproperty("src",o.dateStruct)("property","year")("label","Year")("disabled",o.disabled)}}function h(e,t){if(1&e&&(l.ɵɵelementStart(0,"div"),l.ɵɵtemplate(1,u,1,5,"date-element",13),l.ɵɵtemplate(2,m,1,4,"date-element",14),l.ɵɵtemplate(3,f,1,4,"date-element",14),l.ɵɵelementEnd()),2&e){var n=l.ɵɵnextContext();l.ɵɵadvance(1),l.ɵɵproperty("ngIf",n.need.day),l.ɵɵadvance(1),l.ɵɵproperty("ngIf",n.need.month),l.ɵɵadvance(1),l.ɵɵproperty("ngIf",n.need.year)}}var y=function(){function o(t){this.timeUtils=t,this.dateChange=new e.EventEmitter,this.style="arrows",this.stepDays=1,this.referenceDate=null,this.disabled=!1,this.step=!1,this.need={day:!0,month:!0,year:!0},this.atMax=!1,this.atMin=!1}return o.prototype.ngAfterViewInit=function(){},o.prototype.ngOnChanges=function(e){e.minDate&&(this.minDateStruct=this.timeUtils.convertDate(this.minDate)),e.maxDate&&(this.maxDateStruct=this.timeUtils.convertDate(this.maxDate)),e.date&&(this.dateStruct=this.timeUtils.convertDate(this.date)),e.timestep&&this.assessDateComponents(),this.checkLimits()},o.prototype.dateStructChanged=function(){this.date=new Date(Date.UTC(this.dateStruct.year,this.dateStruct.month-1,this.dateStruct.day)),this.checkReference(),this.dateChange.emit(this.date)},o.prototype.assessDateComponents=function(){this.need.day=this.need.month=this.need.year=!0,"daily"!==this.timestep&&(this.need.day=!1,"annual"===this.timestep&&(this.need.month=!1))},o.prototype.move=function(e){this.date=new Date(this.date&&this.date.getTime()),this.date.setDate(this.date.getDate()+e),this.onDateChanged(),this.dateChange.emit(this.date)},o.prototype.onDateChanged=function(){this.checkLimits()},o.prototype.checkLimits=function(){this.atMax=this.timeUtils.datesEqual(this.dateStruct,this.maxDateStruct),this.atMin=this.timeUtils.datesEqual(this.dateStruct,this.minDateStruct)},o.prototype.checkReference=function(){if(this.referenceDate){var e=r.InterpolationService.interpolate(this.referenceDate,{year:this.date.getFullYear(),month:this.date.getMonth()+1,date:this.date.getDate()}).split("-").map((function(e){return+e})),t=new Date(Date.UTC(e[0],e[1]-1,e[2]));console.log("currentRef",t),console.log("currentDate",this.date);var n=864e5*this.stepDays,o=(this.date.getTime()-t.getTime())/n;this.date=new Date(t.getTime()+Math.round(o)*n),this.dateStruct=this.timeUtils.convertDate(this.date)}},o.ɵfac=function(e){return new(e||o)(l.ɵɵdirectiveInject(s.TimeUtilsService))},o.ɵcmp=l.ɵɵdefineComponent({type:o,selectors:[["date-selection"]],inputs:{date:"date",timestep:"timestep",minDate:"minDate",maxDate:"maxDate",style:"style",stepDays:"stepDays",referenceDate:"referenceDate",disabled:"disabled",step:"step"},outputs:{dateChange:"dateChange"},features:[l.ɵɵNgOnChangesFeature],decls:3,vars:2,consts:[[1,"date-control","container-fluid"],["class","row no-gutters",4,"ngIf"],[4,"ngIf"],[1,"row","no-gutters"],[1,"col-12","form-group-inline"],[1,"input-group","input-group-sm"],["class","ds-btn input-group-addon",3,"click",4,"ngIf"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","",1,"form-control","form-control-sm",3,"ngModel","maxDate","minDate","disabled","ngModelChange"],["d","ngbDatepicker"],[1,"ds-btn","input-group-addon",3,"click"],[1,"fa","fa-calendar"],[1,"fa","fa-angle-left"],[1,"fa","fa-angle-right"],[3,"src","property","label","step","disabled","changed",4,"ngIf"],[3,"src","property","label","disabled","changed",4,"ngIf"],[3,"src","property","label","step","disabled","changed"],[3,"src","property","label","disabled","changed"]],template:function(e,t){1&e&&(l.ɵɵelementStart(0,"div",0),l.ɵɵtemplate(1,d,9,6,"div",1),l.ɵɵtemplate(2,h,4,3,"div",2),l.ɵɵelementEnd()),2&e&&(l.ɵɵadvance(1),l.ɵɵproperty("ngIf","arrows"!==t.style),l.ɵɵadvance(1),l.ɵɵproperty("ngIf","arrows"===t.style))},directives:[a.NgIf,n.NgbInputDatepicker,t.DefaultValueAccessor,t.NgControlStatus,t.NgModel,w.DateElementComponent],styles:[".dc-btn[_ngcontent-%COMP%] {\n    min-width:10px;\n  }"]}),o}();i.DateSelectionComponent=y}))),M=(d(x),x.DateSelectionComponent,u((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}))),D=(d(M),u((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}))),O=(d(D),u((function(e,t){var n=c&&c.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),o=c&&c.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),o(M,t),o(D,t)}))),E=(d(O),u((function(i,l){var s=c&&c.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),p=c&&c.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(l,"__esModule",{value:!0}),l.MapWaldLeafletModule=void 0;var d=e;p(O,l),p(m,l),p(f,l),p(h,l),p(y,l),p(v,l),p(g,l),p(C,l),p(b,l),p(S,l),p(w,l),p(x,l);h.DrawComponent,y.GeojsonLayerComponent,f.LeafletMapComponent,v.LegendComponent,g.MapControlComponent,C.OneTimeSplashComponent,b.VectorTileLayerComponent,S.WmsLayerComponent,w.DateElementComponent,x.DateSelectionComponent;var u=[m.LeafletService],M=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:u}},e.ɵmod=d.ɵɵdefineNgModule({type:e}),e.ɵinj=d.ɵɵdefineInjector({factory:function(t){return new(t||e)},providers:u,imports:[[a.CommonModule,t.FormsModule,o.HttpClientModule,n.NgbModule,r.MapWaldCoreModule]]}),e}();l.MapWaldLeafletModule=M,("undefined"==typeof ngJitMode||ngJitMode)&&d.ɵɵsetNgModuleScope(M,{declarations:[h.DrawComponent,y.GeojsonLayerComponent,f.LeafletMapComponent,v.LegendComponent,g.MapControlComponent,C.OneTimeSplashComponent,b.VectorTileLayerComponent,S.WmsLayerComponent,w.DateElementComponent,x.DateSelectionComponent],imports:[a.CommonModule,t.FormsModule,o.HttpClientModule,n.NgbModule,r.MapWaldCoreModule],exports:[h.DrawComponent,y.GeojsonLayerComponent,f.LeafletMapComponent,v.LegendComponent,g.MapControlComponent,C.OneTimeSplashComponent,b.VectorTileLayerComponent,S.WmsLayerComponent,w.DateElementComponent,x.DateSelectionComponent]})})));d(E),E.MapWaldLeafletModule;return d(u((function(e,t){var n=c&&c.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),o=c&&c.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),o(E,t)})))}));
//# sourceMappingURL=map-wald-leaflet.umd.min.js.map